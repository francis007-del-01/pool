pool:
  name: "example-pool"
  version: "1.0"

  # TPS-based Hierarchical Executors (each with its own queue)
  adapters:
    executors:
      # Root executor - overall TPS budget
      - id: "main"
        tps: 1000                           # Max 1000 unique requests/sec total
        queue_capacity: 5000                # Queue for tasks hitting main's TPS limit
        identifier_field: "$req.requestId"  # Count by request ID

      # Child executor for fast/VIP traffic
      - id: "fast"
        parent: "main"
        tps: 500                            # Max 500 unique requests/sec for fast
        queue_capacity: 2000                # Queue for fast executor
        identifier_field: "$req.requestId"

      # Child executor for bulk traffic  
      - id: "bulk"
        parent: "main"
        tps: 300                            # Max 300 unique requests/sec for bulk
        queue_capacity: 1000                # Queue for bulk executor
        identifier_field: "$req.requestId"

  # Priority Strategy Configuration
  priority-strategy:
    type: FIFO

  # Priority tree - routes tasks to executors at leaf nodes
  # Uses unified syntax: condition is an expression string with nested-levels
  priority-tree:
    # Level 1: Region-based routing
    - name: "L1.NORTH_AMERICA"
      condition: '$req.region == "NORTH_AMERICA"'
      nested-levels:
        # Level 2: Customer tier
        - name: "L2.PLATINUM"
          condition: '$req.customerTier == "PLATINUM"'
          nested-levels:
            # Level 3: Transaction amount
            - name: "L3.HIGH_VALUE"
              condition: "$req.transactionAmount > 100000"
              sort-by:
                field: $req.priority
                direction: DESC
              executor: "fast"  # Route to fast executor

            - name: "L3.DEFAULT"
              condition: "true"
              sort-by:
                field: $req.urgency
                direction: DESC
              executor: "fast"

        - name: "L2.GOLD"
          condition: '$req.customerTier == "GOLD"'
          nested-levels:
            - name: "L3.DEFAULT"
              condition: "true"
              sort-by:
                field: $sys.submittedAt
                direction: ASC
              executor: "fast"

        - name: "L2.DEFAULT"
          condition: "true"
          nested-levels:
            - name: "L3.DEFAULT"
              condition: "true"
              sort-by:
                field: $sys.submittedAt
                direction: ASC
              executor: "bulk"  # Route to bulk executor

    - name: "L1.EUROPE"
      condition: '$req.region == "EUROPE"'
      nested-levels:
        - name: "L2.DEFAULT"
          condition: "true"
          nested-levels:
            - name: "L3.DEFAULT"
              condition: "true"
              sort-by:
                field: $req.priority
                direction: DESC
              executor: "fast"

    # Catch-all for other regions
    - name: "L1.DEFAULT"
      condition: "true"
      nested-levels:
        - name: "L2.DEFAULT"
          condition: "true"
          nested-levels:
            - name: "L3.DEFAULT"
              condition: "true"
              sort-by:
                field: $sys.submittedAt
                direction: ASC
              executor: "bulk"  # Default to bulk executor
